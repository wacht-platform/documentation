# API Auth App (Frontend API)

The API Auth App endpoints allow authenticated users to manage API keys and view audit logs for their API auth app sessions. These endpoints require an active API auth app session obtained via session ticket exchange.

## Overview

API Auth Apps provide a way to issue and manage API keys for programmatic access. The frontend API endpoints allow users with an active session to:

- View their current API auth app session
- List, create, rotate, and revoke API keys
- View audit logs and analytics

## Authentication

All endpoints require:
1. An active user session (cookie-based)
2. An active API auth app session (obtained via `POST /session/ticket/exchange` with an `api_auth_access` ticket)

## Endpoints

### Session

#### Get Current Session

```
GET /api-auth/session
```

Returns information about the current API auth app session.

**Response**

```json
{
  "session_id": "123456789012345678",
  "api_auth_app": {
    "id": "111111111111111111",
    "app_slug": "mobile-app",
    "name": "Mobile Application",
    "key_prefix": "wacht_mobile_",
    "description": "API keys for mobile apps",
    "is_active": true,
    "rate_limits": [...]
  }
}
```

### API Keys

#### List Keys

```
GET /api-auth/keys
```

**Query Parameters**

| Parameter | Type | Description |
|-----------|------|-------------|
| `status` | string | Filter by status: `active`, `revoked`, `expired` |
| `include_inactive` | boolean | Include inactive keys (default: false) |

#### Create Key

```
POST /api-auth/keys
```

**Form Parameters**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `name` | string | Yes | Key name |
| `expires_at` | string | No | Expiration timestamp (RFC3339) |

**Response**

Returns the full API key (only shown once):

```json
{
  "id": "123456789012345678",
  "name": "Production Server",
  "key": "wacht_mobile_sk_live_abcdefghijklmnopqrstuvwxyz",
  "key_prefix": "wacht_mobile_",
  "key_suffix": "wxyz",
  "expires_at": null,
  "created_at": "2024-01-15T10:30:00Z"
}
```

#### Rotate Key

```
POST /api-auth/keys/{id}/rotate
```

Generates a new key value while keeping the same key ID and metadata.

#### Revoke Key

```
POST /api-auth/keys/{id}/revoke
```

**Form Parameters**

| Parameter | Type | Description |
|-----------|------|-------------|
| `reason` | string | Optional reason for revocation |

### Audit Logs

#### Get Audit Logs

```
GET /api-auth/audit/logs
```

**Query Parameters**

| Parameter | Type | Description |
|-----------|------|-------------|
| `limit` | integer | Max results (default: 100, max: 1000) |
| `offset` | integer | Number to skip |
| `cursor` | string | Base64-encoded pagination cursor |
| `outcome` | string | Filter by: `success`, `blocked`, `error` |
| `key_id` | string | Filter by key ID |
| `start_date` | string | Start date (RFC3339) |
| `end_date` | string | End date (RFC3339) |

#### Get Analytics

```
GET /api-auth/audit/analytics
```

**Query Parameters**

| Parameter | Type | Description |
|-----------|------|-------------|
| `start_date` | string | Start date (RFC3339) |
| `end_date` | string | End date (RFC3339) |
| `key_id` | string | Filter by key ID |
| `include_top_keys` | boolean | Include top keys by usage |
| `include_top_paths` | boolean | Include top paths by usage |
| `include_blocked_reasons` | boolean | Include blocked reasons breakdown |
| `include_rate_limits` | boolean | Include rate limit hit stats |
| `top_limit` | integer | Limit for top items (max: 50) |

#### Get Timeseries

```
GET /api-auth/audit/timeseries
```

**Query Parameters**

| Parameter | Type | Description |
|-----------|------|-------------|
| `start_date` | string | Start date (RFC3339) |
| `end_date` | string | End date (RFC3339) |
| `interval` | string | Grouping: `minute`, `hour`, `day`, `week` |
| `key_id` | string | Filter by key ID |

## Rate Limiting

API Auth Apps support configurable rate limits:

| Mode | Description |
|------|-------------|
| `per_key` | Limits per API key |
| `per_ip` | Limits per IP address |
| `per_key_and_ip` | Combined key + IP limits |
| `per_app` | Limits across all keys |
| `per_app_and_ip` | App-wide limits per IP |

## Related

- [Session Tickets](/backend-api/session-tickets) - Creating API auth access tickets
- [API Keys (Backend API)](/backend-api/api-keys) - Server-side API key management
